<div class="game-load-screen">
    <button class="close-btn" onclick="goBackToLauncher()">&times;</button>
    <div class="loading-text">Loading Game...</div>
    <button class="start-btn" onclick="startGame()">START</button>

    <!-- Clear button -->
    <button class="debug-btn" onclick="clearUserProgress()" >
        Clear All Data
    </button>
</div>

<script>
// Auto-show debug info when page loads
document.addEventListener('DOMContentLoaded', () => {
    setTimeout(() => {
        if (window.app && window.app.userProgress) {
            showDebugInfo();
        }
    }, 500); // Wait for app initialization
});


function clearUserProgress() {
    console.log('ðŸ§¹ Debug: Button clicked');
    if (window.app && window.app.userProgress) {
        console.log('ðŸ§¹ Debug: About to call clearProgress');
        window.app.userProgress.clearProgress();
        console.log('ðŸ§¹ Debug: clearProgress completed');

        // Refresh the display
        showDebugInfo();
    }
}

function showDebugInfo() {
    const debugDiv = document.getElementById('debugInfo');
    if (!debugDiv) {
        // Create debug div if it doesn't exist
        const div = document.createElement('div');
        div.id = 'debugInfo';
        div.style.cssText = `position: absolute; bottom: 80px; left: 20px; right: 20px;
                background: rgba(0,0,0,0.9); color: #00ff00; padding: 15px;
                font-family: monospace; font-size: 11px;
                max-height: 50vh; overflow-y: auto; border: 1px solid #00ff00;
                border-radius: 5px;`;
        document.querySelector('.game-load-screen').appendChild(div);
    }

    const userProgress = window.app.userProgress;
    
    // Use existing methods
    const debugInfo = userProgress.getDebugInfo();
    const textStats = userProgress.getTextStatsDebug();
    const currentData = userProgress.getCurrentData();

    let html = '<strong style="color: #ffff00;">===== DEBUG INFO =====</strong><br>';

    // Game title on its own line
    const projectMetadata = userProgress.gameData.getProjectMetadata();
    const gameTitle = projectMetadata ? projectMetadata.title : 'La Grande DÃ©ception';
    html += `${gameTitle}<br>`;
    
    // Texts and phrases count
    html += `${debugInfo.totalUniqueTexts} texts<br>`;
    html += `${debugInfo.totalPhrases} phrases<br>`;

    // Progress section
    html += '<strong style="color: #00ffff;">ðŸ“Š PROGRESS</strong><br>';
    html += `Total Games: ${debugInfo.gamesPlayed}<br>`;
    html += `Total Mastered Phrases: ${debugInfo.masteredPhrases} (${debugInfo.masteredPercentage}%)<br>`;
    
    if (currentData.lastStage) {
        html += `Last Stage: Stage ${currentData.lastStage.stageNumber} [${currentData.lastStage.texts.join(', ')}]<br>`;
    } else {
        html += `Last Stage: None<br>`;
    }
    
    html += `Next Text: ${debugInfo.nextText}<br>`;

    // Text stats section
    html += '<strong style="color: #00ffff;">ðŸ“ˆ TEXT STATS</strong><br>';
    if (textStats && typeof textStats === 'object') {
        Object.keys(textStats).sort().forEach(textId => {
            const textData = textStats[textId];
            const levelDisplays = [];
            
            for (let level = 1; level <= 3; level++) {
                const levelKey = `level${level}`;
                const levelData = textData[levelKey];
                
                if (levelData && levelData.rounds > 0) {
                    let levelDisplay = `L${level} R${levelData.rounds}`;
                    
                    if (levelData.attempts) {
                        const sortedAttempts = Object.entries(levelData.attempts).sort((a, b) => {
                            const numA = parseInt(a[0].split('_')[2].substring(1));
                            const numB = parseInt(b[0].split('_')[2].substring(1));
                            return numA - numB;
                        });
                        
                        sortedAttempts.forEach(([phraseId, attempts]) => {
                            const phraseNum = phraseId.split('_')[2];
                            const attemptStr = attempts.map(a => a === 'mastered' ? 'M' : a).join(',');
                            levelDisplay += ` ${phraseNum}(${attemptStr})`;
                        });
                    }
                    
                    levelDisplays.push(levelDisplay);
                }
            }
            
            if (levelDisplays.length > 0) {
                html += `${textId} ${levelDisplays.join(', ')}<br>`;
            }
        });
    }

    if (window.app && window.app.gameAnalytics) {
        const analyticsDebug = window.app.gameAnalytics.getDebugInfo();
        if (analyticsDebug && analyticsDebug.textStatsDisplay) {
            html += '<br><strong style="color: #ff00ff;">ðŸ“Š ANALYTICS STATS</strong><br>';
            html += analyticsDebug.textStatsDisplay + '<br>';
        }
    }

    document.getElementById('debugInfo').innerHTML = html;
}

// Auto-refresh every 2 seconds
setInterval(() => {
    if (window.app && window.app.userProgress) {
        showDebugInfo();
    }
}, 2000);


</script>
